# 엔티티 매핑

## @Entity

* 테이블과 매핑할 클래스는 @Entity 어노테이션을 필수로 붙야야한다.
* @Entity가 붙은 클래스는 JPA가 관리하고 엔터티라고 부른다.
* 기본 생성자는 필수다(파라미터가 없는 public , protected 생성자)
* final 클래스 , enum , interface , inner 클래스에는 사용할 수 없다.
* 저장할 필드에 final을 사용하면 안된다.

`@Entity 속성 정리`

|속성|기능|기본값|
|----|----|---|
|name|테이블 기본 데이터 타입 (UDT는 비추)|테이블 기본 데이터 타입 (UDT는 비추)|



## @Table

* @Table은 엔터티와 매핑할 테이블을 지정한다.
* 생략하면 매핑한 엔티티 이름을 테이블 이름으로 사용한다.


## 다양한 매핑 사용

`요구사항`

1. 회원은 일반 회원과 관리자로 구분해야 한다.
2. 회원 가입일과 수정일이 있어야 한다.
3. 회원을 설명할 수 있는 필드가 있어야 한다. 이 필드는 길이 제한이 없다.



``` java

  @Entity
  @Table(name="MEMBER", uniqueConstraints = {@UniqueConstraint( //추가 //**
          name = "NAME_AGE_UNIQUE",
          columnNames = {"NAME", "AGE"} )})
  public class Member {
  
      @Id
      @Column(name = "ID")
      private String id;
  
      @Column(name = "NAME", nullable = false, length = 10)
      private String username;
  
      private Integer age;
  
      //=== 추가
      @Enumerated(EnumType.STRING)
      private RoleType roleType;
  
      @Temporal(TemporalType.TIMESTAMP)
      private Date createdDate;
  
      @Temporal(TemporalType.TIMESTAMP)
      private Date lastModifiedDate;
  
      @Lob
      private String description;
  
      @Transient
      private String temp;
    }

```

``` java

  public enum RoleType {
      ADMIN, USER
  }


```


### @Enumerated

### @Temporal

### @Lob



## 데이터베이스 스키마 자동 생성

`<property name="hibernate.hbm2ddl.auto" value="create" />`

애플리케이션 실행 시점에 데이터베이스 테이블을 자동으로 생성한다.

`<property name="hibernate.show_sql" value="true" />`

테이블 생성 DDL을 출력해준다.



`hibernate.hbm2ddl.auto 속`

|옵션|설명|
|---|---|
|create	|기존 테이블을 삭제하고 새로 생성한다. DROP + CREATE|
|create-drop|create 속성에 추가로 애플리케이션을 종료할 때 생성한 DDL을 제거한다. DROP + CREATE + DROP|
|update	|데이터베이스 테이블과 엔티티 매핑정보를 비교해서 변경 사항만 수정한다.|
|validate|데이터베이스 테이블과 엔티티 매핑정보를 비교해서 차이가 있으면 경고를 남기고 애플리케이션을 실행하지 않는다. 이설정은 DDL을 수정하지 않는다.|



## DDL 생성 기능

* 회원 이름은 필수
>> nullable = false
* 10자를 초과하면 안되는 제약조건
>> length = 10


``` java

  @Column(name = "NAME", nullable = false, length = 10)
  private String username;


```


* 유니크 제약조건
>> UniqueConstraint 속성

``` java

  @Entity
  @Table(name="MEMBER", uniqueConstraints = {@UniqueConstraint( //추가 //**
          name = "NAME_AGE_UNIQUE",
          columnNames = {"NAME", "AGE"} )})
  public class Member {
  
      @Id
      @Column(name = "ID")
      private String id;
  
      @Column(name = "NAME", nullable = false, length = 10)
      private String username;
  
      private Integer age;
      
      ....
      
      }


```

>> 위와 같은 기능들은 단지 DDL을 자동 생성할 때만 사용되고 JPA의 실행 로직에는 영향을 주지않는다.<br>
따라서 스키마 자동생성 기능을 사용하지 않고 직접 DDL을 만든다면 사용할 이유가 없다.



## 기본 키 매핑


``` java

    @Id
    @Column(name = "ID")
    private String id;


```

`직접 할당 방식: 기본 키를 애플리케이션에서 직접 할당한다.`

``` java

    String id = "id5";
    Member member = new Member();
    member.setId(id);

```





`자동 생성 방식: 대리 키 사용 방식 , 데이터베이스가 생성해주는 값을 사용`

* IDENTITY : 기본 키 생성을 데이터베이스에 위임한다.




* SEQUENCE : 데이터베이스 시퀀스를 사용해서 기본 키를 할당한다.
* TABLE : 키 생성 테이블을 생성한다.



## 필드와 컬럼 매핑 : 레퍼런스
